---
title: "CTIS Mental Health"
author: "Christian Hobelsberger, Max Lang, Elisa Shima"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Import & Wrangling

We are using the R Package CTIS to get access to the API Interface, more information on <https://github.com/CaroHaensch/CTIS>.

```{r Data Import & Wrangling}
devtools::install_github("CaroHaensch/CTIS")
library(CTIS)
library(tidyverse)
library(reshape2)

indicator_list = list("anxious_7d", "depressed_7d", "worried_become_ill", "finance", "food_security")

data <- lapply(X = indicator_list, 
               FUN = function(x){
                 CTIS_open_data_country(indicator = x, type = "daily", country = "all", daterange = "")
                 })
data <- as.data.frame(do.call(rbind, data))
data_trimmed <- data[,c(1:5, 7)]
data_aggregated <- dcast(data = data_trimmed, 
                         formula = data.country+data.iso_code+data.gid_0+data.survey_date~data.indicator, 
                         value.var = "data.pct")

data_aggregated$data.country <- as.factor(data_aggregated$data.country)

data_aggregated$data.survey_date <- as.Date(x = data_aggregated$data.survey_date, "%Y%m%d")

sum(table(data_aggregated$data.country) >= 600)

head(data_aggregated)
```

## Data Wrangling

We are using the R Package CTIS to get access to the API Interface, more information on <https://github.com/CaroHaensch/CTIS>.

```{r Data Import}
data$data.country <- as.factor(data$data.country)

data$data.survey_date <- as.Date(x = data$data.survey_date, "%Y%m%d")

table(data$data.country) >= 600

sum(table(data$data.country) >= 600)

head(data)

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
